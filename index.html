<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Your Page Title</title>
  </head>
  <body>
    <button id="authorize-button" onclick="handleAuthClick()">Authorize and Load</button>
    <button id="execute-button" disabled onclick="execute()">Execute</button>
    <a href ="./">Link</a>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
      var clientId = '304082893135-5rd4ad03ka2vvaivdognfvrbm2vf86o6.apps.googleusercontent.com';
      var apiKey = 'AIzaSyDuAslBRz68wGqTRsbIPlJXtaiyCr3Bdt4';
      var scopes = 'https://www.googleapis.com/auth/yt-analytics.readonly';

      function handleClientLoad() {
        gapi.client.setApiKey(apiKey);
        window.setTimeout(checkAuth, 1);
      }

      function checkAuth() {
        gapi.auth.authorize({
          client_id: clientId,
          scope: scopes,
          immediate: true
        }, handleAuthResult);
      }

      function handleAuthResult(authResult) {
        var authorizeButton = document.getElementById('authorize-button');
        var executeButton = document.getElementById('execute-button');

        if (authResult && !authResult.error) {
          authorizeButton.style.visibility = 'hidden';
          executeButton.disabled = false;
        } else {
          authorizeButton.style.visibility = 'visible';
          executeButton.disabled = true;
          authorizeButton.onclick = handleAuthClick;
        }
      }

      function handleAuthClick(event) {
        gapi.auth.authorize({
          client_id: clientId,
          scope: scopes,
          immediate: false
        }, handleAuthResult);
        return false;
      }

      function execute() {
        gapi.client.load('youtubeAnalytics', 'v2', function() {
          var request = gapi.client.youtubeAnalytics.reports.query({
            'ids': 'channel==MINE',
            'startDate': '2023-03-01',
            'endDate': '2023-04-06',
            'metrics': 'views,estimatedMinutesWatched,averageViewDuration,averageViewPercentage,subscribersGained',
            'dimensions': 'day',
            'sort': 'day'
          });

          request.execute(function(response) {
            console.log(response);
          });
        });
      }

      function init() {
        gapi.client.load('youtubeAnalytics', 'v2', function() {
          checkAuth();
        });
      }
      gapi.load('client:auth2', init);
    </script>
  </body>
</html>
